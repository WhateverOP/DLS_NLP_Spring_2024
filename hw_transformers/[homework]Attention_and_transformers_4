{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[{"file_id":"1q77WixYXvCFQtvRD-RbCQe7zC06hn7d7","timestamp":1708365361858},{"file_id":"12BxEICwjMhOcIQID1zn06K6kFG92GZcf","timestamp":1708035269638},{"file_id":"1pYR9hzeFxq1T5kZThLvgA7bkmcNQtbrq","timestamp":1707661673565}],"machine_shape":"hm"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"2b58d798abd54fa09bbeae67ab4fdb55":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_ef1d543a5a50480b9d54bb700babc495","IPY_MODEL_7348051aed9544c587a18fa363128d73","IPY_MODEL_345bea8ea4e24bdcbc2cf97e62f2bd31"],"layout":"IPY_MODEL_8cad1a7bae89452ab7ae4ed99d01659a"}},"ef1d543a5a50480b9d54bb700babc495":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_fc6580df77c646cabdaaeffdbdfdd2fa","placeholder":"​","style":"IPY_MODEL_ada6856f162c4b10b7ba8ee6ad6e6ad1","value":"tokenizer_config.json: 100%"}},"7348051aed9544c587a18fa363128d73":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_2011a5a2406a46e18e84efcb4442677c","max":28,"min":0,"orientation":"horizontal","style":"IPY_MODEL_3ecfdc90b02f405a87df966ce57d512a","value":28}},"345bea8ea4e24bdcbc2cf97e62f2bd31":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_343d4cde17984e10977faa383725a5c5","placeholder":"​","style":"IPY_MODEL_0a783afbeb294043a1a3079b97b88e1e","value":" 28.0/28.0 [00:00&lt;00:00, 1.89kB/s]"}},"8cad1a7bae89452ab7ae4ed99d01659a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fc6580df77c646cabdaaeffdbdfdd2fa":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ada6856f162c4b10b7ba8ee6ad6e6ad1":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2011a5a2406a46e18e84efcb4442677c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3ecfdc90b02f405a87df966ce57d512a":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"343d4cde17984e10977faa383725a5c5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0a783afbeb294043a1a3079b97b88e1e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cbcfe39aca6343a6ae2ccfcf10dfafb6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a2eba704bb354eeda6ce986ba70179ae":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"d999f20e92ad46b9b30eac0a15217f52":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ccceae81e62e4e53a95df751be5e861d":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"061bf4014159437e807cf50d8777e2af":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"5f8cfcb3649c4e8bb8f7ba2d33a01c54":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"307fa82b93374393a2a67b6750ed1f6a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_d999f20e92ad46b9b30eac0a15217f52","placeholder":"​","style":"IPY_MODEL_ccceae81e62e4e53a95df751be5e861d","value":"vocab.txt: 100%"}},"bda5d9fb407f4344a49f3d943e20a57e":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_cbcfe39aca6343a6ae2ccfcf10dfafb6","max":231508,"min":0,"orientation":"horizontal","style":"IPY_MODEL_a2eba704bb354eeda6ce986ba70179ae","value":231508}},"19f84bd96442451792a28a253f2c3161":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_061bf4014159437e807cf50d8777e2af","placeholder":"​","style":"IPY_MODEL_5f8cfcb3649c4e8bb8f7ba2d33a01c54","value":" 232k/232k [00:00&lt;00:00, 4.96MB/s]"}},"30a31b4a1d0343bdbb6ab7f215017690":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3f4e228b2eb64f8b9dec536f1ff92d58":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_307fa82b93374393a2a67b6750ed1f6a","IPY_MODEL_bda5d9fb407f4344a49f3d943e20a57e","IPY_MODEL_19f84bd96442451792a28a253f2c3161"],"layout":"IPY_MODEL_30a31b4a1d0343bdbb6ab7f215017690"}},"a71515de12324e519ffe3ca4ec9863bb":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"5179a3b741474017a5d22797bc3ca834":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"2eea6c65a7ab4f3db48d8038c3eb20c7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a8f4373944c94b448e66c972acd744f1":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"9d86b8067fae4c049bda5092fd898bbd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"142f6cf74d6a4cfaa9bd09bb5dd54c31":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"63ae5dd54b3541fdae711b65177138b9":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_2eea6c65a7ab4f3db48d8038c3eb20c7","placeholder":"​","style":"IPY_MODEL_a8f4373944c94b448e66c972acd744f1","value":"tokenizer.json: 100%"}},"81d871ffb2fc464bbecdbea3d8e79646":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_a71515de12324e519ffe3ca4ec9863bb","max":466062,"min":0,"orientation":"horizontal","style":"IPY_MODEL_5179a3b741474017a5d22797bc3ca834","value":466062}},"a044bebbfdba4f1197a51361a35d0220":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_9d86b8067fae4c049bda5092fd898bbd","placeholder":"​","style":"IPY_MODEL_142f6cf74d6a4cfaa9bd09bb5dd54c31","value":" 466k/466k [00:00&lt;00:00, 6.32MB/s]"}},"8eef5657483c45cf8759efe088f8946d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8568a6bc2d8243cfafbfd5d07e9e404c":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_63ae5dd54b3541fdae711b65177138b9","IPY_MODEL_81d871ffb2fc464bbecdbea3d8e79646","IPY_MODEL_a044bebbfdba4f1197a51361a35d0220"],"layout":"IPY_MODEL_8eef5657483c45cf8759efe088f8946d"}},"ab13fbf18b3a42f6bfac11549b95750c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a62c21682e68450181cc09aed6961420":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0a8b405f1cb449d3acc4bb719897b75f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8d75a46a231c4375a1a4f8d8da971412":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"14b92a62cdef41bb931da7f76cbf1ae4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"34b10ca8214d4f34ac6b96fb74104e6a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"c474146021b644c89c4c1a05e2442aee":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0a8b405f1cb449d3acc4bb719897b75f","placeholder":"​","style":"IPY_MODEL_8d75a46a231c4375a1a4f8d8da971412","value":"config.json: 100%"}},"57b3921946ad458ba7c2b12139a9c925":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_ab13fbf18b3a42f6bfac11549b95750c","max":483,"min":0,"orientation":"horizontal","style":"IPY_MODEL_a62c21682e68450181cc09aed6961420","value":483}},"255d89c8d81e4c6ba2623a1dbf0477b7":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_14b92a62cdef41bb931da7f76cbf1ae4","placeholder":"​","style":"IPY_MODEL_34b10ca8214d4f34ac6b96fb74104e6a","value":" 483/483 [00:00&lt;00:00, 34.6kB/s]"}},"90ce4c7ae4a94170b5b81908a7482051":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e3ee576e00d1458aa478567a4c22a876":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_c474146021b644c89c4c1a05e2442aee","IPY_MODEL_57b3921946ad458ba7c2b12139a9c925","IPY_MODEL_255d89c8d81e4c6ba2623a1dbf0477b7"],"layout":"IPY_MODEL_90ce4c7ae4a94170b5b81908a7482051"}}}}},"cells":[{"cell_type":"markdown","source":["<p style=\"align: center;\"><img src=\"https://static.tildacdn.com/tild6636-3531-4239-b465-376364646465/Deep_Learning_School.png\" width=\"400\"></p>\n","\n","# Глубокое обучение. Часть 2\n","# Домашнее задание по теме \"Механизм внимания\""],"metadata":{"id":"Ji8KtYOVGs8_"}},{"cell_type":"markdown","source":["Это домашнее задание проходит в формате peer-review. Это означает, что его будут проверять ваши однокурсники. Поэтому пишите разборчивый код, добавляйте комментарии и пишите выводы после проделанной работы.\n","\n","В этом задании вы будете решать задачу классификации математических задач по темам (многоклассовая классификация) с помощью Transformer.\n","\n","В качестве датасета возьмем датасет математических задач по разным темам. Нам необходим следующий файл:\n","\n","[Файл с классами](https://docs.google.com/spreadsheets/d/1IMRxByfg7gjoZ5i7rxvuNDvSrbdOJOc-/edit?usp=drive_link&ouid=104379615679964018037&rtpof=true&sd=true)"],"metadata":{"id":"UAr-M8_1GJ6W"}},{"cell_type":"markdown","source":["**Hint:** не перезаписывайте модели, которые вы получите на каждом из этапов этого дз. Они ещё понадобятся."],"metadata":{"id":"1fybMcmV0YRA"}},{"cell_type":"code","source":["from google.colab import output\n","output.enable_custom_widget_manager()\n","\n","from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"uianmuEkjX0I","executionInfo":{"status":"ok","timestamp":1711998079801,"user_tz":-180,"elapsed":27543,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"6a6dd441-513e-4923-d25c-3d834d999df6"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","source":["path_to_data = '/content/drive/MyDrive/Deep_Learning_MIPT_2/hw_transformers/data_problems.xlsx'\n","\n","import torch\n","import torch.nn as nn\n","from torch.utils.data import Dataset, DataLoader\n","\n","import numpy as np\n","import pandas as pd\n","import matplotlib.pyplot as plt\n","\n","from tqdm.auto import tqdm\n","from nltk.tokenize import word_tokenize\n","from sklearn.model_selection import train_test_split\n","from sklearn.utils import shuffle\n","import nltk\n","\n","from collections import Counter\n","from typing import List\n","import string\n","\n","import random\n","\n","from transformers import DistilBertModel\n","from transformers import DistilBertTokenizer\n","\n","import seaborn\n","seaborn.set(palette='summer')\n","\n","device = 'cuda' if torch.cuda.is_available() else 'cpu'\n","print(device)\n","\n","nltk.download('punkt')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"avyH0R2RjZi_","executionInfo":{"status":"ok","timestamp":1711998087867,"user_tz":-180,"elapsed":8078,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"154e6f51-a437-42cd-9721-bbb11cdc6d18"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["cpu\n"]},{"output_type":"stream","name":"stderr","text":["[nltk_data] Downloading package punkt to /root/nltk_data...\n","[nltk_data]   Unzipping tokenizers/punkt.zip.\n"]},{"output_type":"execute_result","data":{"text/plain":["True"]},"metadata":{},"execution_count":2}]},{"cell_type":"code","source":["init_df = pd.read_excel(path_to_data)\n","\n","print(f'init_df.shape = {init_df.shape}')\n","print(f'init_df.keys() = {init_df.keys()}')\n","\n","df = init_df.drop(columns=['Unnamed: 0'])\n","\n","df = df.rename(columns={'Задача': 'text', 'Тема': 'label'})"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"7aiuRj1XjZlu","executionInfo":{"status":"ok","timestamp":1711998113892,"user_tz":-180,"elapsed":1576,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"94fe1bfd-da51-499d-f4f1-ca06d74bc497"},"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["init_df.shape = (5273, 3)\n","init_df.keys() = Index(['Unnamed: 0', 'Задача', 'Тема'], dtype='object')\n"]}]},{"cell_type":"code","source":["labels_vocab = list(set(df['label']))\n","label2ind = {char: i for i, char in enumerate(labels_vocab)}\n","ind2label = {i: char for char, i in label2ind.items()}"],"metadata":{"id":"9ZK0wHBGjpII","executionInfo":{"status":"ok","timestamp":1711998114994,"user_tz":-180,"elapsed":4,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":4,"outputs":[]},{"cell_type":"code","source":["tokenizer = DistilBertTokenizer.from_pretrained('distilbert-base-uncased')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":274,"referenced_widgets":["2b58d798abd54fa09bbeae67ab4fdb55","ef1d543a5a50480b9d54bb700babc495","7348051aed9544c587a18fa363128d73","345bea8ea4e24bdcbc2cf97e62f2bd31","8cad1a7bae89452ab7ae4ed99d01659a","fc6580df77c646cabdaaeffdbdfdd2fa","ada6856f162c4b10b7ba8ee6ad6e6ad1","2011a5a2406a46e18e84efcb4442677c","3ecfdc90b02f405a87df966ce57d512a","343d4cde17984e10977faa383725a5c5","0a783afbeb294043a1a3079b97b88e1e","cbcfe39aca6343a6ae2ccfcf10dfafb6","a2eba704bb354eeda6ce986ba70179ae","d999f20e92ad46b9b30eac0a15217f52","ccceae81e62e4e53a95df751be5e861d","061bf4014159437e807cf50d8777e2af","5f8cfcb3649c4e8bb8f7ba2d33a01c54","307fa82b93374393a2a67b6750ed1f6a","bda5d9fb407f4344a49f3d943e20a57e","19f84bd96442451792a28a253f2c3161","30a31b4a1d0343bdbb6ab7f215017690","3f4e228b2eb64f8b9dec536f1ff92d58","a71515de12324e519ffe3ca4ec9863bb","5179a3b741474017a5d22797bc3ca834","2eea6c65a7ab4f3db48d8038c3eb20c7","a8f4373944c94b448e66c972acd744f1","9d86b8067fae4c049bda5092fd898bbd","142f6cf74d6a4cfaa9bd09bb5dd54c31","63ae5dd54b3541fdae711b65177138b9","81d871ffb2fc464bbecdbea3d8e79646","a044bebbfdba4f1197a51361a35d0220","8eef5657483c45cf8759efe088f8946d","8568a6bc2d8243cfafbfd5d07e9e404c","ab13fbf18b3a42f6bfac11549b95750c","a62c21682e68450181cc09aed6961420","0a8b405f1cb449d3acc4bb719897b75f","8d75a46a231c4375a1a4f8d8da971412","14b92a62cdef41bb931da7f76cbf1ae4","34b10ca8214d4f34ac6b96fb74104e6a","c474146021b644c89c4c1a05e2442aee","57b3921946ad458ba7c2b12139a9c925","255d89c8d81e4c6ba2623a1dbf0477b7","90ce4c7ae4a94170b5b81908a7482051","e3ee576e00d1458aa478567a4c22a876"]},"id":"OYhfYThLneL-","executionInfo":{"status":"ok","timestamp":1711998118145,"user_tz":-180,"elapsed":2514,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"22ccdd2f-a631-431b-f51a-7194aa546a88"},"execution_count":5,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.10/dist-packages/huggingface_hub/utils/_token.py:88: UserWarning: \n","The secret `HF_TOKEN` does not exist in your Colab secrets.\n","To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.\n","You will be able to reuse this secret in all of your notebooks.\n","Please note that authentication is recommended but still optional to access public models or datasets.\n","  warnings.warn(\n"]},{"output_type":"display_data","data":{"text/plain":["tokenizer_config.json:   0%|          | 0.00/28.0 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"2b58d798abd54fa09bbeae67ab4fdb55"}},"metadata":{"application/vnd.jupyter.widget-view+json":{"colab":{"custom_widget_manager":{"url":"https://ssl.gstatic.com/colaboratory-static/widgets/colab-cdn-widget-manager/2b70e893a8ba7c0f/manager.min.js"}}}}},{"output_type":"display_data","data":{"text/plain":["vocab.txt:   0%|          | 0.00/232k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"3f4e228b2eb64f8b9dec536f1ff92d58"}},"metadata":{"application/vnd.jupyter.widget-view+json":{"colab":{"custom_widget_manager":{"url":"https://ssl.gstatic.com/colaboratory-static/widgets/colab-cdn-widget-manager/2b70e893a8ba7c0f/manager.min.js"}}}}},{"output_type":"display_data","data":{"text/plain":["tokenizer.json:   0%|          | 0.00/466k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"8568a6bc2d8243cfafbfd5d07e9e404c"}},"metadata":{"application/vnd.jupyter.widget-view+json":{"colab":{"custom_widget_manager":{"url":"https://ssl.gstatic.com/colaboratory-static/widgets/colab-cdn-widget-manager/2b70e893a8ba7c0f/manager.min.js"}}}}},{"output_type":"display_data","data":{"text/plain":["config.json:   0%|          | 0.00/483 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"e3ee576e00d1458aa478567a4c22a876"}},"metadata":{"application/vnd.jupyter.widget-view+json":{"colab":{"custom_widget_manager":{"url":"https://ssl.gstatic.com/colaboratory-static/widgets/colab-cdn-widget-manager/2b70e893a8ba7c0f/manager.min.js"}}}}}]},{"cell_type":"code","source":["text_len_list = []\n","for text in df['text']:\n","    text_len_list.append(len(text))"],"metadata":{"id":"f9JIaSI8qZel","executionInfo":{"status":"ok","timestamp":1711998126202,"user_tz":-180,"elapsed":4104,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":6,"outputs":[]},{"cell_type":"code","source":["print(np.mean(text_len_list))\n","print(max(text_len_list))\n","print(min(text_len_list))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"88oJsHy_qnv3","executionInfo":{"status":"ok","timestamp":1711998126671,"user_tz":-180,"elapsed":6,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"81f8a64e-96d6-4582-ac64-9d77d9b9342a"},"execution_count":7,"outputs":[{"output_type":"stream","name":"stdout","text":["314.98710411530436\n","4489\n","1\n"]}]},{"cell_type":"code","source":["test_text = df['text'].iloc[0]\n","print(test_text)\n","encode_test = tokenizer.encode_plus(test_text, max_length=1024, padding='max_length', truncation=True, return_tensors='pt')\n","print(encode_test['input_ids'])\n","print(encode_test['attention_mask'])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Z6E5GQ8CnriZ","executionInfo":{"status":"ok","timestamp":1711998126910,"user_tz":-180,"elapsed":5,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"3b44fb76-27a5-4a2d-846d-b093b0b3102f"},"execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["Между девятью планетами Солнечной системы введено космическое сообщение.  Ракеты летают по следующим маршрутам: Земля – Меркурий, Плутон – Венера, Земля – Плутон, Плутон – Меркурий, Меркурий – Венера, Уран – Нептун, Нептун – Сатурн, Сатурн – Юпитер, Юпитер – Марс и Марс – Уран. Можно ли добраться с Земли до Марса? \n","tensor([[  101,  1191, 15290,  ...,     0,     0,     0]])\n","tensor([[1, 1, 1,  ..., 0, 0, 0]])\n"]}]},{"cell_type":"code","source":["print(list(map(tokenizer.decode, encode_test['input_ids'])))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Nyq2aH5Ao_m1","executionInfo":{"status":"ok","timestamp":1711998129072,"user_tz":-180,"elapsed":256,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"fb333702-b2d8-44f3-bc2f-4cbc76e45699"},"execution_count":9,"outputs":[{"output_type":"stream","name":"stdout","text":["['[CLS] между девятью планетами солнечнои системы введено космическое сообщение. ракеты летают по следующим маршрутам : земля – меркурии, плутон – венера, земля – плутон, плутон – меркурии, меркурии – венера, уран – нептун, нептун – сатурн, сатурн – юпитер, юпитер – марс и марс – уран. можно ли добраться с земли до марса? [SEP] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD]']\n"]}]},{"cell_type":"code","source":["class WordDataset:\n","    def __init__(self, sentences, max_length=256):\n","        self.data = sentences\n","        self.max_length = max_length\n","\n","    def __getitem__(self, idx: int) -> List[int]:\n","        encode = tokenizer.encode_plus(self.data.iloc[idx]['text'], max_length=self.max_length, padding='max_length', truncation=True, return_tensors='pt')\n","        tokenized_sentence = encode['input_ids']\n","        attention_mask = encode['attention_mask']\n","\n","        train_sample = {\n","            \"text\": tokenized_sentence,\n","            \"mask\": attention_mask,\n","            \"label\": label2ind[self.data.iloc[idx]['label']]\n","        }\n","\n","        return train_sample\n","\n","    def __len__(self) -> int:\n","        return len(self.data)"],"metadata":{"id":"h4P1GOYeuvhW","executionInfo":{"status":"ok","timestamp":1711999192193,"user_tz":-180,"elapsed":5,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":49,"outputs":[]},{"cell_type":"code","source":["df_shuffled = shuffle(df)\n","df_train = df_shuffled[:int(len(df_shuffled)*0.8)]\n","df_test  = df_shuffled[int(len(df_shuffled)*0.8):]\n","\n","train_dataset = WordDataset(df_train)\n","eval_dataset = WordDataset(df_test)"],"metadata":{"id":"w0Zyl3dNuvj0","executionInfo":{"status":"ok","timestamp":1711999194808,"user_tz":-180,"elapsed":13,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":50,"outputs":[]},{"cell_type":"code","source":["index = 1\n","print(len(train_dataset[index]['text']))\n","print(train_dataset[index]['text'])\n","print(list(map(tokenizer.decode, train_dataset[index]['text'])))\n","print(train_dataset[index]['mask'])\n","print(train_dataset[index]['label'])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"to20fAI1uvnN","executionInfo":{"status":"ok","timestamp":1711999194809,"user_tz":-180,"elapsed":12,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"6a8b154c-6b22-4001-a524-c4a64941fde1"},"execution_count":51,"outputs":[{"output_type":"stream","name":"stdout","text":["1\n","tensor([[  101,  1182,  1189, 14150, 29745, 29746, 28995, 15414,  1188, 29744,\n","          1196, 15290, 29745, 10325,  1202, 15290, 29436, 19259, 15290, 23925,\n","          1190, 29757, 29740, 29113, 15290,  1203, 15290, 29747, 22919, 23742,\n","          1191, 14150, 29741, 29748, 22919,  1196, 15290, 29747, 22919, 23742,\n","          1187, 10260,  1189, 16856, 29748, 29741, 29436, 29113, 10325,  1196,\n","         22919, 14150, 29436,  1197, 10260, 23925,  1010,  1202, 22919, 14150,\n","          1189, 10260, 29743, 29742, 29113, 15290,  1184, 25529, 10260,  1196,\n","         14150, 29747, 15290, 29742, 10260,  1193, 28598, 29743, 29748, 22919,\n","         29747, 17432,  1187, 19865, 23925, 14150, 29745, 29113, 29745, 10325,\n","          1012,  1184, 14150, 28598, 29743, 10325, 22919, 15290,  1010,  1202,\n","         22919, 14150,  1188,  1182, 29747, 29757,  1189, 14150, 29745, 29746,\n","         28995, 10325, 29757,  1191, 14150, 29743, 18947, 14150,  1198, 29747,\n","         10260, 29742, 10325, 22919, 23742,  1187, 10260,  1189, 16856, 29748,\n","         29741, 29436, 29113, 10325,  1196, 22919, 14150, 29436,  1197, 10260,\n","         23925,  1010,  1202, 22919, 14150,  1189, 10260, 29743, 29742, 29113,\n","         15290,  1184, 25529, 10260,  1196, 14150, 29747, 15290, 29742, 10260,\n","          1193, 28598, 29743, 29748, 22919, 29747, 17432,  1187, 19865, 23925,\n","         14150, 29745, 29113, 29745, 10325,  1012,   102,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0,     0,     0,     0,     0,\n","             0,     0,     0,     0,     0,     0]])\n","['[CLS] в компании из семи человек любые шесть могут сесть за круглыи стол так, что каждые два соседа окажутся знакомыми. докажите, что и всю компанию можно усадить за круглыи стол так, что каждые два соседа окажутся знакомыми. [SEP] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD] [PAD]']\n","tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n","         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n","         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n","         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n","         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n","         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n","         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n","         1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n","         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n","         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n","         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]])\n","5\n"]}]},{"cell_type":"code","source":["batch_size = 4\n","train_dataloader = DataLoader(\n","    train_dataset, shuffle=True, batch_size=batch_size)\n","\n","eval_dataloader = DataLoader(\n","    eval_dataset, shuffle=False, batch_size=batch_size)"],"metadata":{"id":"cD3gXidU1amG","executionInfo":{"status":"ok","timestamp":1711999194809,"user_tz":-180,"elapsed":7,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":52,"outputs":[]},{"cell_type":"code","source":["counter = 0\n","for batch in train_dataloader:\n","    if counter > 1:\n","        break\n","    print(batch)\n","    counter += 1"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"vh2mdfOr1hGF","executionInfo":{"status":"ok","timestamp":1711999195284,"user_tz":-180,"elapsed":7,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"b55312c8-cd0f-4a0b-9ce2-120f89a69166"},"execution_count":53,"outputs":[{"output_type":"stream","name":"stdout","text":["{'text': tensor([[[  101,  1182,  1189,  ...,  1196, 29748,   102]],\n","\n","        [[  101,  1198,  1202,  ...,     0,     0,     0]],\n","\n","        [[  101,  1194, 16856,  ..., 16856, 29748,   102]],\n","\n","        [[  101,  1192, 10260,  ..., 22919, 17432,   102]]]), 'mask': tensor([[[1, 1, 1,  ..., 1, 1, 1]],\n","\n","        [[1, 1, 1,  ..., 0, 0, 0]],\n","\n","        [[1, 1, 1,  ..., 1, 1, 1]],\n","\n","        [[1, 1, 1,  ..., 1, 1, 1]]]), 'label': tensor([5, 5, 3, 5])}\n","{'text': tensor([[[  101,  1202, 10325,  ...,     0,     0,     0]],\n","\n","        [[  101,  1196, 29748,  ...,     0,     0,     0]],\n","\n","        [[  101,  1193, 29740,  ...,     0,     0,     0]],\n","\n","        [[  101,  1189, 10260,  ...,     0,     0,     0]]]), 'mask': tensor([[[1, 1, 1,  ..., 0, 0, 0]],\n","\n","        [[1, 1, 1,  ..., 0, 0, 0]],\n","\n","        [[1, 1, 1,  ..., 0, 0, 0]],\n","\n","        [[1, 1, 1,  ..., 0, 0, 0]]]), 'label': tensor([5, 5, 5, 5])}\n"]}]},{"cell_type":"markdown","source":["### Задание 1 (2 балла)\n","\n","Напишите кастомный класс для модели трансформера для задачи классификации, использующей в качествке backbone какую-то из моделей huggingface.\n","\n","Т.е. конструктор класса должен принимать на вход название модели и подгружать её из huggingface, а затем использовать в качестве backbone (достаточно возможности использовать в качестве backbone те модели, которые упомянуты в последующих пунктах)"],"metadata":{"id":"t395freCxpOE"}},{"cell_type":"code","source":["# ### This is just an interface example. You may change it if you want.\n","\n","# class TransformerClassificationModel(nn.Module):\n","#     def __init__(self, num_classes):\n","#         super(TransformerClassificationModel, self).__init__()\n","#         self.backbone = DistilBertModel.from_pretrained('distilbert-base-uncased')\n","#         self.drop = nn.Dropout(p=0.2)\n","#         self.fc = nn.Linear(self.backbone.config.hidden_size, num_classes)\n","#         # YOUR CODE: create additional layers for classfication\n","\n","#     def forward(self, inputs, attention_mask):\n","#         # YOUR CODE: propagate inputs through the model. Return dict with logits\n","#         output = self.backbone(input_ids=inputs, attention_mask=attention_mask)\n","#         pooled_output = outputs[0][:, 0, :] # Take the first token's output\n","#         outputs = self.fc(pooled_output)\n","#         return outputs\n","\n","#     def freeze_backbone(self):\n","#         for param in self.backbone.parameters():\n","#             param.requires_grad = False\n","\n","#     def unfreeze_backbone(self):\n","#         for param in self.backbone.parameters():\n","#             param.requires_grad = True"],"metadata":{"id":"eX4VGWquyiMx","executionInfo":{"status":"ok","timestamp":1711999195540,"user_tz":-180,"elapsed":4,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":54,"outputs":[]},{"cell_type":"code","source":["class TransformerClassificationModel(nn.Module):\n","    def __init__(self, num_classes):\n","        super(TransformerClassificationModel, self).__init__()\n","        self.backbone = DistilBertModel.from_pretrained('distilbert-base-uncased')\n","        self.drop = nn.Dropout(p=0.2)\n","        self.fc = nn.Linear(self.backbone.config.hidden_size, num_classes)\n","\n","    def forward(self, input_ids, attention_mask):\n","        outputs = self.backbone(input_ids=input_ids, attention_mask=attention_mask)\n","        pooled_output = outputs[0][:, 0, :]  # Take the first token's output\n","        return self.fc(pooled_output)\n","        # output = self.drop(pooled_output)\n","        # return self.fc(output)"],"metadata":{"id":"gTPIvoIcC0GQ","executionInfo":{"status":"ok","timestamp":1711999195541,"user_tz":-180,"elapsed":4,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":55,"outputs":[]},{"cell_type":"code","source":["model_test = TransformerClassificationModel(num_classes=len(label2ind)).to(device)"],"metadata":{"id":"FG15zmEh1rF4","executionInfo":{"status":"ok","timestamp":1711999196889,"user_tz":-180,"elapsed":5,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":56,"outputs":[]},{"cell_type":"code","source":["# model_test.freeze_backbone()"],"metadata":{"id":"GuKm5Hk41rIN","executionInfo":{"status":"ok","timestamp":1711999198750,"user_tz":-180,"elapsed":2,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":57,"outputs":[]},{"cell_type":"code","source":["print(batch['text'].shape)\n","print(batch['mask'].shape)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"chxG-75A2poP","executionInfo":{"status":"ok","timestamp":1711999199460,"user_tz":-180,"elapsed":14,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"ba8cfca7-3793-44c0-ea8a-ea0f8fa00b0d"},"execution_count":58,"outputs":[{"output_type":"stream","name":"stdout","text":["torch.Size([4, 1, 256])\n","torch.Size([4, 1, 256])\n"]}]},{"cell_type":"code","source":["print(batch['text'].squeeze(1).shape)\n","print(batch['mask'].squeeze(1).shape)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"CHik29ceDWDZ","executionInfo":{"status":"ok","timestamp":1711999199461,"user_tz":-180,"elapsed":14,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"596a7f28-1fbe-4775-d25e-dfbcc980efe8"},"execution_count":59,"outputs":[{"output_type":"stream","name":"stdout","text":["torch.Size([4, 256])\n","torch.Size([4, 256])\n"]}]},{"cell_type":"code","source":["print(batch['text'].squeeze(1).permute(1,0).shape)\n","print(batch['mask'].squeeze(1).permute(1,0).shape)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"AHgEivPBFtwC","executionInfo":{"status":"ok","timestamp":1711999199461,"user_tz":-180,"elapsed":7,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"a95a5e1b-8dfd-41f8-fe2f-3307db661480"},"execution_count":60,"outputs":[{"output_type":"stream","name":"stdout","text":["torch.Size([256, 4])\n","torch.Size([256, 4])\n"]}]},{"cell_type":"code","source":["print(batch['text'].permute(0, 2, 1).shape)\n","print(batch['mask'].permute(0, 2, 1).shape)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"rUhC2w615YS9","executionInfo":{"status":"ok","timestamp":1711999201514,"user_tz":-180,"elapsed":6,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"53549083-6c45-4278-edba-d10d4185618a"},"execution_count":61,"outputs":[{"output_type":"stream","name":"stdout","text":["torch.Size([4, 256, 1])\n","torch.Size([4, 256, 1])\n"]}]},{"cell_type":"code","source":["# test_out = model_test(batch['text'].permute(0, 2, 1), batch['mask'].permute(0, 2, 1))"],"metadata":{"id":"nbR-4ABA1rKO","executionInfo":{"status":"ok","timestamp":1711999201515,"user_tz":-180,"elapsed":4,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":62,"outputs":[]},{"cell_type":"code","source":["test_out = model_test(batch['text'].squeeze(1), batch['mask'].squeeze(1))\n","print(test_out)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"jIpmLTLe1rMM","executionInfo":{"status":"ok","timestamp":1711999223846,"user_tz":-180,"elapsed":333,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"eb0ac5ea-57b4-4cb4-eef3-435aace203a5"},"execution_count":68,"outputs":[{"output_type":"stream","name":"stdout","text":["tensor([[-0.4656, -0.1537, -0.6303, -0.2849,  0.0028,  0.0305,  0.1474],\n","        [-0.5516, -0.1177, -0.5957, -0.2611,  0.0692, -0.0700,  0.1367],\n","        [-0.5701, -0.1172, -0.5816, -0.2636,  0.0880, -0.0395,  0.1201],\n","        [-0.5239, -0.1025, -0.6146, -0.2565,  0.0136,  0.0118,  0.1027]],\n","       grad_fn=<AddmmBackward0>)\n"]}]},{"cell_type":"code","source":[],"metadata":{"id":"NZRAYma01rN-","executionInfo":{"status":"ok","timestamp":1711999209313,"user_tz":-180,"elapsed":330,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":63,"outputs":[]},{"cell_type":"code","source":["class DistilBERTTextClassifier(nn.Module):\n","    def __init__(self, num_classes):\n","        super(DistilBERTTextClassifier, self).__init__()\n","        self.distilbert = DistilBertModel.from_pretrained('distilbert-base-uncased')\n","        self.drop = nn.Dropout(p=0.2)\n","        self.fc = nn.Linear(self.distilbert.config.hidden_size, num_classes)\n","\n","    def forward(self, input_ids, attention_mask):\n","        outputs = self.distilbert(input_ids=input_ids, attention_mask=attention_mask)\n","        pooled_output = outputs[0][:, 0, :]  # Take the first token's output\n","        output = self.drop(pooled_output)\n","        return self.fc(output)\n"],"metadata":{"id":"mpXC_LvWEHqq","executionInfo":{"status":"ok","timestamp":1711999209532,"user_tz":-180,"elapsed":3,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}}},"execution_count":64,"outputs":[]},{"cell_type":"code","source":["# Example batch input data\n","batch_input_ids = torch.tensor([\n","    [101, 1045, 2023, 2003, 1037, 2516, 2697, 2005, 3030, 18059, 102, 0, 0, 0, 0],\n","    [101, 1045, 2064, 2017, 2516, 2697, 2005, 3030, 102, 0, 0, 0, 0, 0, 0]\n","])  # Shape: (batch_size, max_seq_length)\n","\n","batch_attention_mask = torch.tensor([\n","    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0],\n","    [1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0]\n","])  # Shape: (batch_size, max_seq_length)\n","\n","# Initialize model\n","model = DistilBERTTextClassifier(num_classes=2)\n","\n","# Forward propagation\n","output = model(batch_input_ids, batch_attention_mask)\n","\n","print(output)\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"nc9X9agvEHtM","executionInfo":{"status":"ok","timestamp":1711999210288,"user_tz":-180,"elapsed":523,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"f1fb69f9-b1f5-469c-cb60-bb0bb0083f0d"},"execution_count":65,"outputs":[{"output_type":"stream","name":"stdout","text":["tensor([[0.4692, 0.6748],\n","        [0.4069, 0.5642]], grad_fn=<AddmmBackward0>)\n"]}]},{"cell_type":"code","source":["print(batch_input_ids.shape)\n","print(batch_attention_mask.shape)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"qUAegAJ9EObC","executionInfo":{"status":"ok","timestamp":1711999210289,"user_tz":-180,"elapsed":6,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"84f18eaa-e453-4a67-f436-1c4c1f53150b"},"execution_count":66,"outputs":[{"output_type":"stream","name":"stdout","text":["torch.Size([2, 15])\n","torch.Size([2, 15])\n"]}]},{"cell_type":"code","source":["test_out = model_test(batch_input_ids, batch_attention_mask)\n","print(test_out)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0oU0cEUHEbD4","executionInfo":{"status":"ok","timestamp":1711999210601,"user_tz":-180,"elapsed":4,"user":{"displayName":"Pavel Oskin","userId":"12795831590389692658"}},"outputId":"b80741e0-c187-46d7-9a7e-aebab2007d62"},"execution_count":67,"outputs":[{"output_type":"stream","name":"stdout","text":["tensor([[-0.2531,  0.0146, -0.4345, -0.1375, -0.1141,  0.2406,  0.2195],\n","        [-0.2614, -0.0093, -0.3734, -0.1244, -0.0430,  0.2995,  0.2703]],\n","       grad_fn=<AddmmBackward0>)\n"]}]},{"cell_type":"markdown","source":["### Задание 2 (1 балл)\n","\n","Напишите функцию заморозки backbone у модели (если необходимо, возвращайте из функции модель)"],"metadata":{"id":"Vd3kxX6hy0d4"}},{"cell_type":"code","source":["def freeze_backbone_function(model: TransformerClassificationModel):\n","    pass"],"metadata":{"id":"U8IuDosbzKe8"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Задание 3 (2 балла)\n","\n","Напишите функцию, которая будет использована для тренировки (дообучения) трансформера (TransformerClassificationModel). Функция должна поддерживать обучение с замороженным и размороженным backbone."],"metadata":{"id":"kybkw6MSzd-K"}},{"cell_type":"code","source":["import copy\n","\n","def train_transformer(transformer_model, freeze_backbone=True)\n","    model = copy.copy(transformer_model)\n","    ### YOUR CODE IS HERE\n","\n","    return finetuned_model"],"metadata":{"id":"EDhrD0BHzxi4"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Задание 4 (1 балл)\n","\n","Проверьте вашу функцию из предыдущего пункта, дообучив двумя способами\n","*cointegrated/rubert-tiny2* из huggingface."],"metadata":{"id":"eUqhI4mV_RTI"}},{"cell_type":"code","source":["rubert_tiny_transformer_model = #...\n","rubert_tiny_finetuned_with_freezed_backbone = train_transformer(rubert_tiny_transformer_model, freeze_backbone=True)\n","\n","rubert_tiny_transformer_model = #...\n","rubert_tiny_full_finetuned = train_transformer(rubert_tiny_transformer_model, freeze_backbone=False)"],"metadata":{"id":"nuxOCBQHAKZC"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Задание 5 (1 балл)\n","\n","Обучите *tbs17/MathBert* (с замороженным backbone и без заморозки), проанализируйте результаты. Сравните скоры с первым заданием. Получилось лучше или нет? Почему?"],"metadata":{"id":"zRi7tkoOAjon"}},{"cell_type":"code","source":["### YOUR CODE IS HERE (probably, similar on the previous step)"],"metadata":{"id":"XKtd3YgNA14E"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Задание 6 (1 балл)\n","\n","Напишите функцию для отрисовки карт внимания первого слоя для моделей из задания"],"metadata":{"id":"EuU6Di26017B"}},{"cell_type":"code","source":["def draw_first_layer_attention_maps(attention_head_ids: List, text: str, model: TransformerClassificationModel):\n","    pass"],"metadata":{"id":"guzGxfcV1Cba"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Задание 7 (1 балл)\n","\n","Проведите инференс для всех моделей **ДО ДООБУЧЕНИЯ** на 2-3 текстах из датасета. Посмотрите на головы Attention первого слоя в каждой модели на выбранных текстах (отрисуйте их отдельно).\n","\n","Попробуйте их проинтерпретировать. Какие связи улавливают карты внимания? (если в модели много голов Attention, то проинтерпретируйте наиболее интересные)"],"metadata":{"id":"Iu0adKw4BLtF"}},{"cell_type":"code","source":["### YOUR CODE IS HERE"],"metadata":{"id":"U2gEF3vkB6eR"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Задание 8 (1 балл)\n","\n","Сделайте то же самое для дообученных моделей. Изменились ли карты внимания и связи, которые они улавливают? Почему?"],"metadata":{"id":"pBNVrOpCCLqk"}},{"cell_type":"code","source":["### YOUR CODE IS HERE"],"metadata":{"id":"F5229WBICWEr"},"execution_count":null,"outputs":[]}]}